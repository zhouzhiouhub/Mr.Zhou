<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠå¤©æ°”æ³¡ç•™è¨€</title>
    <link href="./css/style.css" rel="stylesheet" type="text/css"></head>
<body>

    <!-- èŠå¤©æ°”æ³¡æŒ‰é’® -->
    <button id="chat-btn">ğŸ’¬</button>

    <!-- èŠå¤©çª—å£ -->
    <div id="chat-popup">
        <div id="chat-header">
            <span>ç•™è¨€åé¦ˆ</span>
            <span id="close-chat">&times;</span>
        </div>
        <form id="chat-form">
            <input type="text" id="name" name="name" placeholder="ä½ çš„åå­—" required>
            <input type="email" id="email" name="email" placeholder="é‚®ç®±åœ°å€" required>
            <textarea id="message" name="message" rows="3" placeholder="è¯·è¾“å…¥ç•™è¨€..." required></textarea>
            <button type="submit">å‘é€</button>
        </form>
        <p id="chat-result" style="font-size:12px; color: green;"></p>
    </div>

    <script>
        // è·å–å…ƒç´ 
        const chatBtn = document.getElementById("chat-btn");
        const chatPopup = document.getElementById("chat-popup");
        const closeChat = document.getElementById("close-chat");
        const chatForm = document.getElementById("chat-form");
        const chatResult = document.getElementById("chat-result");
    
        // ç‚¹å‡»æ°”æ³¡æ˜¾ç¤º/éšè—èŠå¤©æ¡†
        chatBtn.addEventListener("click", () => {
            chatPopup.style.display = (chatPopup.style.display === "block") ? "none" : "block";
        });
    
        // å…³é—­æŒ‰é’®
        closeChat.addEventListener("click", () => {
            chatPopup.style.display = "none";
        });
    
        chatForm.addEventListener("submit", function(event) {
    event.preventDefault(); // é˜»æ­¢é»˜è®¤æäº¤è¡Œä¸º

    let formData = new FormData(this);
    let sendButton = document.querySelector("button[type='submit']");

    console.log("å‡†å¤‡å‘é€è¯·æ±‚..."); // **è°ƒè¯•è¾“å‡º**
    
    // ç«‹å³ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢å¤šæ¬¡ç‚¹å‡»
    if (sendButton.disabled) return;
    sendButton.disabled = true; //ç«‹å³ç¦ç”¨æŒ‰é’®
    sendButton.style.backgroundColor = "#ccc"; // å˜ç°è‰²
    sendButton.style.cursor = "not-allowed";

    fetch("send_mail.php", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log("æœåŠ¡å™¨è¿”å›:", data); // **è°ƒè¯•è¾“å‡º**
        
        if (data.status === "success") {
            chatResult.innerHTML = "å‘é€æˆåŠŸï¼";
            chatResult.style.color = "green";

            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById("name").value = "";
            document.getElementById("email").value = "";
            document.getElementById("message").value = "";

            // 2 ç§’åéšè—çª—å£
            setTimeout(() => {
                chatPopup.style.display = "none";
                chatResult.innerHTML = "";
            }, 2000);
        } else {
            chatResult.innerHTML = "å‘é€å¤±è´¥ï¼š" + data.message;
            chatResult.style.color = "red";
        }
    })
    .catch(error => {
        console.log("è¯·æ±‚å¤±è´¥:", error); // **è°ƒè¯•è¾“å‡º**
        chatResult.innerHTML = "å‘é€å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚";
        chatResult.style.color = "red";
    })
    .finally(() => {
        // 1 ç§’åæ¢å¤æŒ‰é’®
        setTimeout(() => {
            sendButton.disabled = false;
            sendButton.style.backgroundColor = "#8E5DA9"; // æ¢å¤é¢œè‰²
            sendButton.style.cursor = "pointer";
        }, 2000);
    });
});

    </script>
    

</body>
</html>
